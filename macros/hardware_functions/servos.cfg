[gcode_macro _SERVO_DEPLOY]
gcode:
    {% set item = params.ITEM|string|lower %}
    {% set verbose = printer["gcode_macro _USER_VARIABLES"].verbose %}

    {% if item == "probe" %}
        {% if verbose %}
            RESPOND MSG="Deploying probe dock using the servo"
        {% endif %}

        {% set probe_servo_name = printer["gcode_macro _USER_VARIABLES"].probe_servo_name %}
        {% set probe_servo_angle_deployed = printer["gcode_macro _USER_VARIABLES"].probe_servo_angle_deployed %}
        SET_SERVO SERVO={probe_servo_name} ANGLE={probe_servo_angle_deployed}
        G4 P500

    {% elif item == "purgebucket" %}
        {% if verbose %}
            RESPOND MSG="Deploying purge bucket using the servo"
        {% endif %}
    
        {% set purgebucket_servo_name = printer["gcode_macro _USER_VARIABLES"].purgebucket_servo_name %}
        {% set purgebucket_servo_angle_deployed = printer["gcode_macro _USER_VARIABLES"].purgebucket_servo_angle_deployed %}
        SET_SERVO SERVO={purgebucket_servo_name} ANGLE={purgebucket_servo_angle_deployed}
        G4 P500
    
    {% else %}
        { action_raise_error("Servo ITEM must be specified!") }
    {% endif %}


[gcode_macro _SERVO_RETRACT]
gcode:
    {% set item = params.ITEM|string|lower %}
    {% set verbose = printer["gcode_macro _USER_VARIABLES"].verbose %}

    {% if item == "probe" %}
        {% if verbose %}
            RESPOND MSG="Deploying probe dock using the servo"
        {% endif %}

        {% set probe_servo_name = printer["gcode_macro _USER_VARIABLES"].probe_servo_name %}
        {% set probe_servo_angle_retracted = printer["gcode_macro _USER_VARIABLES"].probe_servo_angle_retracted %}
        SET_SERVO SERVO={probe_servo_name} ANGLE={probe_servo_angle_retracted}
        G4 P500

    {% elif item == "purgebucket" %}
        {% if verbose %}
            RESPOND MSG="Deploying purge bucket using the servo"
        {% endif %}
    
        {% set purgebucket_servo_name = printer["gcode_macro _USER_VARIABLES"].purgebucket_servo_name %}
        {% set purgebucket_servo_angle_retracted = printer["gcode_macro _USER_VARIABLES"].purgebucket_servo_angle_retracted %}
        SET_SERVO SERVO={purgebucket_servo_name} ANGLE={purgebucket_servo_angle_retracted}
        G4 P500
    
    {% else %}
        { action_raise_error("Servo ITEM must be specified!") }
    {% endif %}
